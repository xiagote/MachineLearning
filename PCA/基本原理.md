文档来源于： http://blog.codinglabs.org/articles/pca-tutorial.html

　　PCA(Prinicpal Component Analysis) 是一种常用的数据分析方法.PCA通过线性变换将原始数据变换为一组各维度线性无关的表示,可用于提取数据的主要特征变量,常用于高纬数据的降维.这篇文章的目的是介绍PCA的基本数学原理。

### 数据的向量表示及降维问题

　　一般情况下,在数据挖掘和机器学习中,数据被表示为向量.例如某个淘宝店2012年全年的流量计交易情况可以看成一组记录的集合,其中每一天的数据是一条记录,格式如下.
    
　(日期,浏览量,访客数,下单数,成交数,成交金额)
 
　　其中“日期”是一个记录标志而非度量值,而数据挖掘关心的大多是度量值,因此如果我们忽略日期这个字段后,我们得到一组记录,每条记录可以被表示为一个五维向量,其中一条看起来大约是这个样子：
  
$$(500,240,25,13,2312.15)^T$$

　　注意这里我用了转置,因为习惯上使用列向量表示一条记录(后面会看到原因),本文后面也会遵循这个准则.不过为了方便有时我会省略转置符号,但我们说到向量默认都是指列向量.
  
　　我们当然可以对这一组五维向量进行分析和挖掘,不过我们知道,很多机器学习算法的复杂度和数据的维数有密切关系,甚至与维数呈指数级关系.当然,这里区区五维的数据,也许还无所谓,但是实际机器学习中处理成千上万甚至几十万维的情况也并不罕见,在这种情况下,机器学习的资源消耗是不可接受的,因此我们必须对数据进行处理,去除不重要的特征,即降维.

　　降维当然意味着信息的丢失,不过鉴于实际数据本身常常存在的相关性,我们可以想办法在降维的同时将信息的损失尽量降低.
  
　　举个例子,假设某学籍数据有两列M和F,其中M列的取值是学生的性别,男性取值为1,女性取值为0;而F列是女性取值为1,男性取值为0.此时如果我们统计全部学籍数据,会发现对于任何一条记录来说,当M为1时F必定为0,反之当M为0时F必定为1.在这种情况下,我们将M或F去掉不会造成任何信息的损失,因为只要保留一列就能完全还原另一列.

　　上面一种情况是一个极端的情况,在现实中基本不能这么完美,但是通常有类似的情况.例如上面淘宝店铺的数据,从经验我们可以知道,“浏览量”和“访客数”往往具有较强的相关关系,而“下单数”和“成交数”也具有较强的相关关系.这里我们非正式的使用“相关关系”这个词.
  
　　这种情况表明,如果我们删除浏览量或访客数其中一个指标,应该能猜想到并不会丢失太多信息.因此可以删除一个,减少特征,降低机器学习的复杂度.
  
### 向量的表示级基变换

　　既然我们面对的数据被抽象维一组向量,那么我们有必要研究一些向量的数学性质.而这些数学性质将成为后续导出PCA的理论基础.
  
#### 内积与投影

　　两个维数相同的向量的内积被定义为:
  
  $$（a_1,a_2,\cdots,a_n）^T \cdot (b_1,b_2,\cdots,b_n)^T\ =\ a_1b_1 + a_2b_2 + \cdots + a_nb_n$$
  
　　内积运算将两个变量映射为一个实数.下面我们分析内积的几何意义.假设A和B是两个n维向量,我们知道n维向量可以等价表示为n维空间中一条从原点发射的有向线段,为了简单起见我们假设A和B均为二维向量,则$A\ =\ （x_1,y_1）$,$B\ =\ (x_2,y_2)$.则在二维平面上A和B可以用两条发自原点的有向线段表示.如下图
  
  <div align=center><img width="300" height="300" src="https://github.com/xiagote/MachineLearning/blob/master/PCA/2d_projection.png"/></div>

　　好,我们现在从A点向B点所在直线引一条垂线.我们知道垂线与B的交点叫做A在B上的投影,再设A与B的夹角是$\alpha$,则投影的矢量长度为$|A|\cos(\alpha)$,其中$|A|=\sqrt(x_1^2+y_1^2)$是向量A的模,也就是A线段的标量长度.

　　注意这里我们专门区分了矢量长度和标量长度,标量长度总是大于等于0,值是线段的长度;而矢量长度可能为负,其绝对值是线段长度,而符号取决于其方向与标准方向相同或相反.
  
#### 基
  
　　下面我们继续在二维空间内讨论向量.上文说过,一个二维向量可以对应二维笛卡尔直角坐标系中从原点出发的一个有向线段.例如下图是这个向量:
  

  <div align=center><img width="300" height="300" src="https://github.com/xiagote/MachineLearning/blob/master/PCA/2dvector.png"/></div>

　　在代数表示方面,我们经常用线段终点的点坐标表示向量,例如上面的向量可以表示为(3,2),这是我们再熟悉不过的向量表示.
  
　　不过我们常常忽略,只有一个(3,2)本身是不能够精确表示一个向量的.我们仔细看一下,这里的3实际表示的是向量在x轴上的投影值是3,在y轴上的投影是2.也就是说我们其实隐式引入了一个定义:以x轴和y轴上正方向长度为1的向量为标准.那么一个向量(3,2)实际是说在x轴投影为3而y轴的投影为2.注意投影是一个矢量,所以可以为负.
  
　　更正式的说,向量(x,y)实际上表示线性组合:
  $$x(1,0)^T+y(0,1)^T$$
  
　　不难证明所有二维向量都可以表示为这样的线性组合.此处(1,0)和(0,1)叫做二维空间中的一组基.
  
  <div align=center><img width="300" height="300" src="https://github.com/xiagote/MachineLearning/blob/master/PCA/2dvector.png"/></div>

　　所以，要准确描述向量,首先要确定一组基,然后给出在基所在的各个直线上的投影值,就可以了.只不过我们经常忽略第一步,而默认以(1,0)和(0,1)为基.

　　我们之所以默认选择(1,0)和(0,1)为基,当然是比较方便,因为他们分别是x和y轴正方向上的单位向量,因此就使得二维平面上点坐标和向量——对应,非常方便.但实际上任何两个线性无关的二维向量都可以成为一组基,所谓线性无关在二维平面内可以直观认为是两个不在一条直线上的向量.

　　例如,(1,1)和(-1,1)也可以成为一组基.一般来说,我们希望基的模是1,因为从内积的意义可以看到,如果基的模是1,那么就可以方便的用向量点乘基而直接获得其在新基上的坐标了!实际上,对于任何一个向量我们总可以找到其同方向上模为1的向量,只要让两个分向量分别除以模就好.例如,上面的基可以变为$(\frac{1}{\sqrt(2)},\frac{1}{\sqrt(2)})$和$(-\frac{1}{\sqrt(2)},\frac{1}{\sqrt(2)})$.

　　现在,我们想获得(3,2)在新基上的坐标,即在两个方向上的投影矢量值,那么根据内积的几何意义,我们只要分别计算(3,2)和两个基的内积,不难得到新的坐标为$(\frac{5}{\sqrt(2)},-\frac{1}{\sqrt(2)})$.下图给出了新的基以及(3,2)在新基上坐标值的示意图：



　　另外这里要注意的是,我们列举的例子中基是正交的(即内积为0,或直观说相互垂直),但可以成为一组基的唯一要求是线性无关,非正交的基也是可以的.不过因为正交基有较好的性质,所以一般使用的基都是正交的.

#### 基变换的矩阵表示

　　下面我们找一种简便的方式来表示基变换.还是拿上面的例子,想一下,将(3,2)变换为新基上的坐标,就是用(3,2)与第一个基做内积运算,作为第一个新的坐标分量,然后用(3,2)与第二个基做内积运算,作为第二个新坐标的分量.实际上,我们可以用矩阵相乘的形式简洁的表示这个变换:



　　其中矩阵的两行分别为两个基,乘以原向量,其结果刚好为新基的坐标.可以稍微推广一下,如果我们有m个二维向量,只要将二维向量按列排成一个两行m列矩阵,然后用“基矩阵”乘以这个矩阵,就得到了所有这些向量在新基上的值.例如(1,1),(2,2),(3,3)想变换到刚才那组基上,则可以表示为:



　　于是一组向量的基被干净的表示为矩阵的相乘.

　　一般的,如果我们有M个N维向量,想将其变换为由R个N为向量表示的新空间中,那么首先将R个基按行组成矩阵A,然后将向量按列组成矩阵B,那么两矩阵相乘AB就是变换结果,其中AB的第m列就是A中第m列变换的结果.

　　数学表示为:



　　其中$p_i$是一个行向量,表示第i个基,$a_j$是一个列向量,表示第j个原始数据记录.

　　特别要注意的是,这里R可以小于N,而R决定了变换后数据的维数.也就是说,我们可以将一N维数据变换到更低维的空间中,变换后的维度取决于基的数量.因此这种矩阵相乘的表示也可以表示降维变换.

　　最后,上述分析同时给矩阵相乘找到了一种物理解释:两个矩阵相乘的意义就是将右边矩阵中的每一列列向量变换到左边矩阵中每一行行向量为基所表示的空间中去.更抽象的说,一个矩阵可以表示一种线性变换.

#### 协方差矩阵及优化目标

　　上面讨论了选择不同的基可以对同样一组数据给出不同的表示,而且如果基的数量小于向量本身的维数,则可以达到降维的效果.但是我们还没有回答一个最关键的问题:如何选择基才是最优的.或者说,如果我们有一组N维向量,现在要将其降到K维(K小于N),那么我们应该如何选择K个基才能最大程度保留原有的信息?

　　为了避免过于抽象的讨论,我们仍以一个具体的例子展开.假设我们的数据由五条记录组成,将它们表示乘矩阵形式:



　　其中每一列为一条数据记录,而一行为一个字段.为了后续处理方便,我们首先将每个字段内所有值都减去字段均值,其结果是将每个字段的均值都变为0(这样做的道理和好处后面会看到).

　　我们看上面的数据,第一个字段均值为2,第二个字段的均值为3,所以变换后:



　　我们可以看到五条数据在平面直角坐标系内的样子:



　　现在问题来了:如果我们必须使用一维来表示这些数据,又希望尽量保留原始的信息,你要如何选择?

　　通过上一节对基变换的讨论我们知道,这个问题实际上是要在二维平面中选择一个方向,将所有数据都投影到这个方向所在直线上,用投影值表示原始记录.这是一个实际的二维降到一维的问题.

　　那么如何选择这个方向(或者说基)才能尽量保留最多的原始信息呢?一种直观的看法是:希望投影后的投影值尽可能分散.

　　以上图为例,可以看出如果向x轴投影,那么最左边的两个点会重叠在一起,中间的两个点也会重叠在一起,于是本身四个各不相同的二维点投影后只剩下两个不同的值了,这个一种严重的信息丢失,同理,如果向y轴投影最上面的两个点和分布在x轴上的两个点也会重叠.所以看来x和y轴都不是最好的选择.我们直观目测,如果向通过第一象限和第三象限的斜线投影,则五个点在投影后还是可以区分的.

　　下面,用数学方法表述这个问题.


#### 方差

　　上文说到,我们希望投影后投影值尽可能分散,而这种分散程度,可以用数学上的方差表述.此处,一个字段的方差可以看做是每个元素与字段均值的差的平方和的均值,即:

$$Var(\alpha=\frac{1}{m}\sum_{i=1}^{m}(\alpha_i - \mu)^2)$$

　　由于上面我们已经将每个字段的均值都化为0了,因此方差可以直接用每个元素的平方和除以元素个数表示:

$$Var(\alpha=\frac{1}{m}\sum_{i=1}^{m}(\alpha_i)^2)$$

　　于是上面的问题被形式化表示为:寻找一个一维基,使得所有数据变换为这个基上的坐标表示后,方差值最大.

#### 协方差

　　对于上面二维降成一维的问题来说,找到那个使得方差最大的方向就可以了.不过对于更高维,还有一个问题需要解决.考虑三维降到二维问题.与之前相同,首先我们希望找到一个方向使得投影后方差最大,这样就完成了第一个方向的选择,继而我们选择第二个投影方向.

　　如果我们还是单纯只选择方差最大的方向,很明显,这个方向与第一个方向应该是“几乎重合在一起”,显然这样的维度是没有用的,因此,应该有其他约束条件.从直观上说,让两个字段尽可能表示更多的原始信息,我们是不希望它们之间存在(线性)相关性的,因为相关性意味着两个字段不是完全独立,必然存在重复表示的信息.

　　数学上可以用两个字段的协方差表示其相关性,由于已经让每个字段均值为0,则:

$$Cov(a,b)=\frac{1}{m}\sum_{i=1}^{m}a_ib_i$$

　　可以看到,在字段均值为0的情况下,两个字段的协方差简洁的表示为其内积除以元素数m.

　　当协方差为0时,表示为两个字段完全独立.为了让协方差为0,我们选择第二个基时只能在与第一个基正交的方向上选择.因此最终选择的两个方向一定是正交的.

　　至此,我们得到了降维问题的优化目标:<b>将一组N维向量降为K维(K大于0,小于N),其目标是选择K个单位(模为1)正交基,使得原始数据变换到这组基上后,各字段两两协方差为0,而字段的方差则尽可能大(在正交的约束下,取最大的K个方差)<\b>.

#### 协方差矩阵

　　上面导出了优化目标,但是这个目标似乎不能直接作为操作指南(或者说算法),因为它之说要什么,但根本没有说怎么做.所以我们要继续在数学上研究计算方案.

　　我们看到,最终要达到的目的与字段内方差基字段见协方差有密切关系.因此我们希望能将两个统一表示,仔细观察发现,两者均可以表示为内积的形式,而内积又与矩阵密切相关.

　　假设
